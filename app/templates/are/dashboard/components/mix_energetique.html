<div class="card mb-4">
	<div class="card-header">
		<div class="row align-items-center">
			<div class="col-md-8">
				<h5 class="mb-0">Mix énergétique</h5>
			</div>
			<div class="col-md-4">
				<label class="form-label small mb-1">Année</label>
				<select class="form-select form-select-sm" id="filterMixAnnee" onchange="updateMixEnergetique()">
					{% for year in range(2020, 2026) %}
					<option value="{{ year }}" {% if year == annee %}selected{% endif %}>{{ year }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
	</div>
	<div class="card-body">
		{% if stats_nationales and stats_nationales.mix_energetique and stats_nationales.mix_energetique|length > 0 %}
		<div class="chart-container">
			<canvas id="mixEnergetiqueChart"></canvas>
		</div>
		<div class="table-responsive mt-3">
			<table class="table table-sm table-striped">
				<thead class="table-dark">
					<tr>
						<th>Source</th>
						<th class="text-end">Production (GWh)</th>
						<th class="text-end">Part (%)</th>
					</tr>
				</thead>
				<tbody>
					{% for item in stats_nationales.mix_energetique %}
					<tr>
						<td><strong>{{ item.source }}</strong></td>
						<td class="text-end">{{ "{:,.1f}".format(item.production_gwh) }}</td>
						<td class="text-end">{{ "{:.1f}".format(item.part_pct) }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="text-center py-5">
			<i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
			<h6 class="text-muted">Aucune donnée de mix énergétique disponible</h6>
			<p class="text-muted small">
				Les graphiques et tableaux du mix énergétique apparaîtront dès que des données de production seront enregistrées dans le système.
			</p>
		</div>
		{% endif %}
	</div>
</div>
<style>
.chart-container {
	height: 350px;
	position: relative;
}
</style>
<script>
// =========== GRAPHIQUE: Mix énergétique ===========
var mixLabels = [];
var mixData = [];
{% for item in stats_nationales.mix_energetique %}
	mixLabels.push({{ (item.source or '')|tojson }});
	mixData.push({{ item.part_pct|float }});
{% endfor %}

if (document.getElementById('mixEnergetiqueChart')) {
	const ctxMix = document.getElementById('mixEnergetiqueChart').getContext('2d');
	new Chart(ctxMix, {
		type: 'pie',
		data: {
			labels: mixLabels,
			datasets: [{
				data: mixData,
				backgroundColor: [
					'rgba(13, 110, 253, 0.8)', // Hydro
					'rgba(220, 53, 69, 0.8)',  // Thermique
					'rgba(255, 193, 7, 0.8)',  // Solaire
					'rgba(25, 135, 84, 0.8)',  // Autres
				],
				borderColor: '#fff',
				borderWidth: 2
			}]
		},
		options: {
			responsive: true,
			plugins: {
				title: {
					display: true,
					text: 'Répartition du mix énergétique (%)'
				},
				legend: {
					position: 'bottom'
				}
			}
		}
	});
}
</script>
