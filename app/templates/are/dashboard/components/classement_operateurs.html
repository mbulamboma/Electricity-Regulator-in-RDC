
<div class="card mb-4">
	<div class="card-header">
		<h5 class="mb-0">Classement des opérateurs par production</h5>
	</div>
	<div class="card-body">
		{% if stats_nationales and stats_nationales['classement_operateurs'] and stats_nationales['classement_operateurs']|length > 0 %}
		<div class="row">
			<!-- Graphique -->
			<div class="col-md-6">
				<div class="chart-container">
					<canvas id="chartClassementOperateurs"></canvas>
				</div>
			</div>
			<!-- Tableau -->
			<div class="col-md-6">
				<div class="table-responsive">
					<table class="table table-sm table-striped">
						<thead class="table-dark">
							<tr>
								<th>Rang</th>
								<th>Opérateur</th>
								<th class="text-end">Production (GWh)</th>
							</tr>
						</thead>
						<tbody>
							{% for op in stats_nationales['classement_operateurs'] %}
							<tr>
								<td>{{ loop.index }}</td>
								<td>{{ op.nom }}</td>
								<td class="text-end">{{ "{:,.1f}".format(op.production_gwh) }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		{% else %}
		<div class="text-center py-5">
			<i class="fas fa-industry fa-3x text-muted mb-3"></i>
			<h6 class="text-muted">Aucun classement disponible</h6>
			<p class="text-muted small">
				Les classements apparaîtront dès que des données de production seront enregistrées.
			</p>
		</div>
		{% endif %}
	</div>
</div>
<style>
.chart-container {
	height: 350px;
	position: relative;
}
</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
var opLabels = [];
var opData = [];
{% for op in stats_nationales['classement_operateurs'] %}
	opLabels.push({{ op.nom|tojson }});
	opData.push({{ op.production_gwh|float }});
{% endfor %}
if (document.getElementById('chartClassementOperateurs')) {
	const ctxOp = document.getElementById('chartClassementOperateurs').getContext('2d');
	new Chart(ctxOp, {
		type: 'bar',
		data: {
			labels: opLabels,
			datasets: [{
				label: 'Production (GWh)',
				data: opData,
				backgroundColor: 'rgba(13, 110, 253, 0.8)',
				borderColor: '#0d6efd',
				borderWidth: 2,
				borderRadius: 4,
				borderSkipped: false,
			}]
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			plugins: {
				title: {
					display: true,
					text: 'Classement des opérateurs par production',
					font: {
						size: 14
					}
				},
				legend: {
					display: false
				}
			},
			scales: {
				x: {
					title: {
						display: true,
						text: 'Opérateur'
					},
					ticks: {
						maxRotation: 45,
						minRotation: 45
					}
				},
				y: {
					beginAtZero: true,
					title: {
						display: true,
						text: 'Production (GWh)'
					},
					ticks: {
						callback: function(value) {
							return value.toLocaleString();
						}
					}
				}
			}
		}
	});
}
</script>
