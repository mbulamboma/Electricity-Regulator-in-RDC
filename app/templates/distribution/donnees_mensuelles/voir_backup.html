{% extends "base.html" %}

{% block title %}DonnÃ©es {{ donnee.get_periode_str() }} - Distribution{% endblock %}

{% block content %}
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5><i class="fa fa-eye"></i> DonnÃ©es Mensuelles - {{ donnee.get_periode_str() }}</h5>
                    <div class="ibox-tools">
                        {% if current_user.operateur_id == donnee.operateur_id %}
                        <a href="{{ url_for('distribution.modifier_donnee_mensuelle', id=donnee.id) }}" class="btn btn-primary btn-xs">
                            <i class="fa fa-pencil"></i> Modifier
                        </a>
                        {% endif %}
                        <a href="{{ url_for('distribution.donnees_mensuelles') }}" class="btn btn-white btn-xs">
                            <i class="fa fa-arrow-left"></i> Retour Ã  la liste
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <!-- En-tÃªte avec infos gÃ©nÃ©rales -->
                    <div class="row m-b-lg">
                        <div class="col-lg-4">
                            <dl class="dl-horizontal">
                                <dt>PÃ©riode:</dt>
                                <dd><span class="label label-primary">{{ donnee.get_periode_str() }}</span></dd>
                                <dt>RÃ©seau:</dt>
                                <dd><strong>{{ donnee.reseau.nom }}</strong></dd>
                                <dt>Type:</dt>
                                <dd>{{ donnee.reseau.type_reseau }}</dd>
                                <dt>OpÃ©rateur:</dt>
                                <dd>{{ donnee.operateur.nom }}</dd>
                            </dl>
                        </div>
                        <div class="col-lg-8">
                            <!-- Indicateurs clÃ©s -->
                            <div class="row">
                                <div class="col-lg-3 col-md-6">
                                    <div class="widget lazur-bg p-md text-center">
                                        <div class="m-b-md">
                                            <i class="fa fa-users fa-2x"></i>
                                            <h3 class="m-xs">{{ '{:,}'.format(donnee.clients_fin_mois or 0) }}</h3>
                                            <small>Clients Total</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="widget yellow-bg p-md text-center">
                                        <div class="m-b-md">
                                            <i class="fa fa-bolt fa-2x"></i>
                                            <h3 class="m-xs">{{ '{:.1f}'.format((donnee.energie_distribuee_ht_mwh or 0) + (donnee.energie_distribuee_mt_mwh or 0) + (donnee.energie_distribuee_bt_mwh or 0)) }}</h3>
                                            <small>MWh Distribuée</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="widget red-bg p-md text-center">
                                        <div class="m-b-md">
                                            <i class="fa fa-usd fa-2x"></i>
                                            <h3 class="m-xs">${{ '{:,.0f}'.format(
                                                (donnee.revenus_ht_usd or 0) + 
                                                (donnee.revenus_mt_usd or 0) + 
                                                (donnee.revenus_bt_usd or 0)
                                            ) }}</h3>
                                            <small>Revenus Total</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="widget navy-bg p-md text-center">
                                        <div class="m-b-md">
                                            <i class="fa fa-percent fa-2x"></i>
                                            <h3 class="m-xs">{{ '{:.1f}%'.format(donnee.taux_paiement or 0) }}</h3>
                                            <small>Taux Paiement</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglets pour les détails -->
                    <div class="tabs-container">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="active">
                                <a data-toggle="tab" href="#clientele" role="tab">
                                    <i class="fa fa-users"></i> Clientèle
                                </a>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#energie" role="tab">
                                    <i class="fa fa-bolt"></i> Énergie
                                </a>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#finances" role="tab">
                                    <i class="fa fa-usd"></i> Finances
                                </a>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#qualite" role="tab">
                                    <i class="fa fa-tachometer"></i> Qualité
                                </a>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#maintenance" role="tab">
                                    <i class="fa fa-wrench"></i> Maintenance
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <!-- Onglet ClientÃ¨le -->
                            <div role="tabpanel" id="clientele" class="tab-pane active">
                                <div class="panel-body">
                                    <div class="row">
                                        <!-- Clients HT -->
                                        <div class="col-md-4">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Clients Haute Tension (HT)</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <td>DÃ©but de mois</td>
                                                            <td class="text-right">{{ donnee.clients_ht_debut_mois or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-success">
                                                            <td>Nouveaux raccordements</td>
                                                            <td class="text-right">+{{ donnee.nouveaux_raccordements_ht or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-danger">
                                                            <td>DÃ©connexions</td>
                                                            <td class="text-right">-{{ donnee.deconnexions_ht or 0 }}</td>
                                                        </tr>
                                                        <tr class="active">
                                                            <td><strong>Fin de mois</strong></td>
                                                            <td class="text-right"><strong>{{ donnee.clients_ht_fin_mois or 0 }}</strong></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Clients MT -->
                                        <div class="col-md-4">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Clients Moyenne Tension (MT)</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <td>DÃ©but de mois</td>
                                                            <td class="text-right">{{ donnee.clients_mt_debut_mois or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-success">
                                                            <td>Nouveaux raccordements</td>
                                                            <td class="text-right">+{{ donnee.nouveaux_raccordements_mt or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-danger">
                                                            <td>DÃ©connexions</td>
                                                            <td class="text-right">-{{ donnee.deconnexions_mt or 0 }}</td>
                                                        </tr>
                                                        <tr class="active">
                                                            <td><strong>Fin de mois</strong></td>
                                                            <td class="text-right"><strong>{{ donnee.clients_mt_fin_mois or 0 }}</strong></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Clients BT -->
                                        <div class="col-md-4">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Clients Basse Tension (BT)</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <td>DÃ©but de mois</td>
                                                            <td class="text-right">{{ donnee.clients_bt_debut_mois or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-success">
                                                            <td>Nouveaux raccordements</td>
                                                            <td class="text-right">+{{ donnee.nouveaux_raccordements_bt or 0 }}</td>
                                                        </tr>
                                                        <tr class="text-danger">
                                                            <td>DÃ©connexions</td>
                                                            <td class="text-right">-{{ donnee.deconnexions_bt or 0 }}</td>
                                                        </tr>
                                                        <tr class="active">
                                                            <td><strong>Fin de mois</strong></td>
                                                            <td class="text-right"><strong>{{ donnee.clients_bt_fin_mois or 0 }}</strong></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Ã‰volution graphique -->
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>RÃ©partition des Clients</h5>
                                                </div>
                                                <div class="ibox-content text-center">
                                                    <canvas id="clientsChart" width="300" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Ã‰volution Mensuelle</h5>
                                                </div>
                                                <div class="ibox-content text-center">
                                                    <canvas id="evolutionChart" width="300" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet Ã‰nergie -->
                            <div role="tabpanel" id="energie" class="tab-pane">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Distribution d'Ã‰nergie par Niveau de Tension</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Niveau</th>
                                                                <th class="text-right">Ã‰nergie DistribuÃ©e (MWh)</th>
                                                                <th class="text-right">Pourcentage</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><span class="label label-danger">HT</span> Haute Tension</td>
                                                                <td class="text-right">{{ '{:.1f}'.format(donnee.energie_distribuee_ht_mwh or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% set total_energie = (donnee.energie_distribuee_ht_mwh or 0) + (donnee.energie_distribuee_mt_mwh or 0) + (donnee.energie_distribuee_bt_mwh or 0) %}
                                                                    {% if total_energie > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.energie_distribuee_ht_mwh or 0) / total_energie) * 100) }}
                                                                    {% else %}
                                                                        0.0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><span class="label label-warning">MT</span> Moyenne Tension</td>
                                                                <td class="text-right">{{ '{:.1f}'.format(donnee.energie_distribuee_mt_mwh or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if total_energie > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.energie_distribuee_mt_mwh or 0) / total_energie) * 100) }}
                                                                    {% else %}
                                                                        0.0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><span class="label label-info">BT</span> Basse Tension</td>
                                                                <td class="text-right">{{ '{:.1f}'.format(donnee.energie_distribuee_bt_mwh or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if total_energie > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.energie_distribuee_bt_mwh or 0) / total_energie) * 100) }}
                                                                    {% else %}
                                                                        0.0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr class="active">
                                                                <td><strong>TOTAL</strong></td>
                                                                <td class="text-right"><strong>{{ '{:.1f}'.format(total_energie) }}</strong></td>
                                                                <td class="text-right"><strong>100.0%</strong></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Pertes d'Ã‰nergie</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <td>Pertes Techniques</td>
                                                            <td class="text-right">{{ '{:.1f}'.format(donnee.pertes_techniques_mwh or 0) }} MWh</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Pertes Commerciales</td>
                                                            <td class="text-right">{{ '{:.1f}'.format(donnee.pertes_commerciales_mwh or 0) }} MWh</td>
                                                        </tr>
                                                        <tr class="active">
                                                            <td><strong>Total Pertes</strong></td>
                                                            <td class="text-right">
                                                                <strong>{{ '{:.1f}'.format((donnee.pertes_techniques_mwh or 0) + (donnee.pertes_commerciales_mwh or 0)) }} MWh</strong>
                                                            </td>
                                                        </tr>
                                                        {% if donnee.taux_pertes_totales %}
                                                        <tr>
                                                            <td>Taux de Pertes</td>
                                                            <td class="text-right">
                                                                <span class="label {% if donnee.taux_pertes_totales <= 10 %}label-primary{% elif donnee.taux_pertes_totales <= 20 %}label-warning{% else %}label-danger{% endif %}">
                                                                    {{ '{:.1f}%'.format(donnee.taux_pertes_totales) }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        {% endif %}
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Graphique de l'Ã©nergie -->
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Distribution d'Ã‰nergie</h5>
                                                </div>
                                                <div class="ibox-content text-center">
                                                    <canvas id="energieChart" width="300" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>RÃ©partition des Pertes</h5>
                                                </div>
                                                <div class="ibox-content text-center">
                                                    <canvas id="pertesChart" width="300" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet Finances -->
                            <div role="tabpanel" id="finances" class="tab-pane">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Revenus de Vente (USD)</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Niveau</th>
                                                                <th class="text-right">Revenus</th>
                                                                <th class="text-right">%</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% set total_revenus = (donnee.revenus_ht_usd or 0) + (donnee.revenus_mt_usd or 0) + (donnee.revenus_bt_usd or 0) %}
                                                            <tr>
                                                                <td>HT</td>
                                                                <td class="text-right">${{ '{:,.0f}'.format(donnee.revenus_ht_usd or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if total_revenus > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.revenus_ht_usd or 0) / total_revenus) * 100) }}
                                                                    {% else %}
                                                                        0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>MT</td>
                                                                <td class="text-right">${{ '{:,.0f}'.format(donnee.revenus_mt_usd or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if total_revenus > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.revenus_mt_usd or 0) / total_revenus) * 100) }}
                                                                    {% else %}
                                                                        0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>BT</td>
                                                                <td class="text-right">${{ '{:,.0f}'.format(donnee.revenus_bt_usd or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if total_revenus > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.revenus_bt_usd or 0) / total_revenus) * 100) }}
                                                                    {% else %}
                                                                        0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr class="active">
                                                                <td><strong>TOTAL</strong></td>
                                                                <td class="text-right"><strong>${{ '{:,.0f}'.format(total_revenus) }}</strong></td>
                                                                <td class="text-right"><strong>100%</strong></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Facturation et Recouvrement</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Indicateur</th>
                                                                <th class="text-right">Valeur</th>
                                                                <th class="text-right">Taux</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>Factures Ã©mises</td>
                                                                <td class="text-right">{{ '{:,}'.format(donnee.factures_emises or 0) }}</td>
                                                                <td class="text-right">-</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Factures payÃ©es</td>
                                                                <td class="text-right">{{ '{:,}'.format(donnee.factures_payees or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if (donnee.factures_emises or 0) > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.factures_payees or 0) / donnee.factures_emises) * 100) }}
                                                                    {% else %}
                                                                        -
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>ImpayÃ©s</td>
                                                                <td class="text-right">${{ '{:,.0f}'.format(donnee.impayes_usd or 0) }}</td>
                                                                <td class="text-right">
                                                                    {% if (donnee.revenus_totaux_usd or 0) > 0 %}
                                                                        {{ '{:.1f}%'.format(((donnee.impayes_usd or 0) / donnee.revenus_totaux_usd) * 100) }}
                                                                    {% else %}
                                                                        -
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            <tr class="{% if donnee.taux_recouvrement and donnee.taux_recouvrement >= 85 %}success{% elif donnee.taux_recouvrement and donnee.taux_recouvrement >= 70 %}warning{% else %}danger{% endif %}">
                                                                <td><strong>Taux de recouvrement</strong></td>
                                                                <td class="text-right">
                                                                    <strong>${{ '{:,.0f}'.format(((donnee.revenus_totaux_usd or 0) - (donnee.impayes_usd or 0))) }}</strong>
                                                                </td>
                                                                <td class="text-right">
                                                                    <strong>{{ '{:.1f}%'.format(donnee.taux_recouvrement or 0) }}</strong>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet QualitÃ© -->
                            <div role="tabpanel" id="qualite" class="tab-pane">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Indicateurs de QualitÃ© de Service</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="statistic-box">
                                                                <h4>{{ donnee.duree_coupures_heures or 0 }}</h4>
                                                                <p>DurÃ©e coupures (h)</p>
                                                                <div class="progress progress-mini">
                                                                    <div style="width: 35%;" class="progress-bar progress-bar-info"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="statistic-box">
                                                                <h4>{{ donnee.nombre_pannes or 0 }}</h4>
                                                                <p>Nombre de pannes</p>
                                                                <div class="progress progress-mini">
                                                                    <div style="width: 65%;" class="progress-bar progress-bar-warning"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="statistic-box">
                                                                <h4>{{ donnee.temps_retablissement_moyen_heures or 0 }}</h4>
                                                                <p>Temps rÃ©tablissement (h)</p>
                                                                <div class="progress progress-mini">
                                                                    {% set duree = donnee.temps_retablissement_moyen_heures or 0 %}
                                                                    {% if duree <= 2 %}
                                                                        <div style="width: 25%;" class="progress-bar progress-bar-success"></div>
                                                                    {% elif duree <= 6 %}
                                                                        <div style="width: 50%;" class="progress-bar progress-bar-warning"></div>
                                                                    {% else %}
                                                                        <div style="width: 100%;" class="progress-bar progress-bar-danger"></div>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="statistic-box">
                                                                <h4>{{ donnee.plaintes_clients or 0 }}</h4>
                                                                <p>Plaintes clients</p>
                                                                <div class="progress progress-mini">
                                                                    <div style="width: 80%;" class="progress-bar"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet Maintenance -->
                            <div role="tabpanel" id="maintenance" class="tab-pane">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>ActivitÃ©s de Maintenance</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <table class="table table-striped table-bordered">
                                                        <tr>
                                                            <td><strong>Nombre d'interventions</strong></td>
                                                            <td class="text-right">{{ donnee.interventions_maintenance or 0 }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>CoÃ»t total de maintenance</strong></td>
                                                            <td class="text-right">${{ '{:,.0f}'.format(donnee.cout_maintenance_usd or 0) }}</td>
                                                        </tr>
                                                        {% if (donnee.interventions_maintenance or 0) > 0 %}
                                                        <tr>
                                                            <td><strong>CoÃ»t moyen par intervention</strong></td>
                                                            <td class="text-right">
                                                                ${{ '{:,.0f}'.format((donnee.cout_maintenance_usd or 0) / donnee.interventions_maintenance) }}
                                                            </td>
                                                        </tr>
                                                        {% endif %}
                                                        {% if (donnee.energie_totale_distribuee_mwh or 0) > 0 %}
                                                        <tr>
                                                            <td><strong>CoÃ»t maintenance / MWh distribuÃ©e</strong></td>
                                                            <td class="text-right">
                                                                ${{ '{:.2f}'.format((donnee.cout_maintenance_usd or 0) / donnee.energie_totale_distribuee_mwh) }}
                                                            </td>
                                                        </tr>
                                                        {% endif %}
                                                    </table>
                                                </div>
                                            </div>

                                            {% if donnee.commentaires %}
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Commentaires et Observations</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <div class="well">
                                                        {{ donnee.commentaires|nl2br }}
                                                    </div>
                                                </div>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="ibox ">
                                                <div class="ibox-title">
                                                    <h5>Informations de Saisie</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    <dl>
                                                        <dt>Saisie crÃ©Ã©e le:</dt>
                                                        <dd>{{ donnee.date_creation.strftime('%d/%m/%Y Ã  %H:%M') }}</dd>
                                                        <dt>DerniÃ¨re modification:</dt>
                                                        <dd>{{ donnee.date_modification.strftime('%d/%m/%Y Ã  %H:%M') }}</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Chart.js pour les graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
{% raw %}
$(document).ready(function(){
    // Activation des onglets Bootstrap
    $('.nav-tabs a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
    });

    // Activer l'onglet basÃ© sur l'ancre dans l'URL
    var hash = window.location.hash;
    if (hash) {
        $('.nav-tabs a[href="' + hash + '"]').tab('show');
    }

    // Mettre Ã  jour l'URL quand on change d'onglet
    $('.nav-tabs a').on('shown.bs.tab', function (e) {
        var target = $(e.target).attr("href");
        if (history.pushState) {
            history.pushState(null, null, target);
        } else {
            window.location.hash = target;
        }
    });

    // Graphiques
    initializeCharts();

    function initializeCharts() {
        // Graphique de rÃ©partition des clients
        var ctx1 = document.getElementById('clientsChart');
        if (ctx1) {
            var clientsData = {
                labels: ['HT', 'MT', 'BT'],
                datasets: [{
                    data: [
                        { donnee.clients_ht_fin_mois or 0 },
                        { donnee.clients_mt_fin_mois or 0 },
                        { donnee.clients_bt_fin_mois or 0 }
                    ],
                    backgroundColor: [
                        "#ed5565",
                        "#f8ac59", 
                        "#1ab394"
                    ]
                }]
            };

            new Chart(ctx1, {
                type: 'doughnut',
                data: clientsData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Graphique d'Ã©volution
        var ctx2 = document.getElementById('evolutionChart');
        if (ctx2) {
            var evolutionData = {
                labels: ['DÃ©but', 'Nouveaux', 'DÃ©connexions', 'Fin'],
                datasets: [{
                    label: 'Clients BT',
                    data: [
                        { donnee.clients_bt_debut_mois or 0 },
                        { donnee.nouveaux_raccordements_bt or 0 },
                        { (donnee.deconnexions_bt or 0) * -1 },
                        { donnee.clients_bt_fin_mois or 0 }
                    ],
                    borderColor: '#1ab394',
                    backgroundColor: 'rgba(26, 179, 148, 0.1)',
                    tension: 0.4
                }]
            };

            new Chart(ctx2, {
                type: 'line',
                data: evolutionData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Graphique d'Ã©nergie
        var ctx3 = document.getElementById('energieChart');
        if (ctx3) {
            var energieData = {
                labels: ['HT', 'MT', 'BT'],
                datasets: [{
                    data: [
                        { donnee.energie_distribuee_ht_mwh or 0 },
                        { donnee.energie_distribuee_mt_mwh or 0 },
                        { donnee.energie_distribuee_bt_mwh or 0 }
                    ],
                    backgroundColor: [
                        "#ed5565",
                        "#f8ac59",
                        "#1ab394"
                    ]
                }]
            };

            new Chart(ctx3, {
                type: 'bar',
                data: energieData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ã‰nergie (MWh)'
                            }
                        }
                    }
                }
            });
        }

        // Graphique des pertes
        var ctx4 = document.getElementById('pertesChart');
        if (ctx4) {
            var pertesData = {
                labels: ['Techniques', 'Commerciales'],
                datasets: [{
                    data: [
                        { donnee.pertes_techniques_mwh or 0 },
                        { donnee.pertes_commerciales_mwh or 0 }
                    ],
                    backgroundColor: [
                        "#f8ac59",
                        "#ed5565"
                    ]
                }]
            };

            new Chart(ctx4, {
                type: 'pie',
                data: pertesData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
});
{% endraw %}
</script>

<!-- CSS pour améliorer le design et ajouter des couleurs -->
<style>
.widget {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    color: white;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.widget:hover {
    transform: translateY(-5px);
}

.lazur-bg {
    background: linear-gradient(135deg, #1ab394 0%, #138d75 100%) !important;
}

.yellow-bg {
    background: linear-gradient(135deg, #f8ac59 0%, #e67e22 100%) !important;
}

.red-bg {
    background: linear-gradient(135deg, #ed5565 0%, #c0392b 100%) !important;
}

.navy-bg {
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
}

/* Amélioration des onglets */
.tabs-container {
    margin-top: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}

.nav-tabs {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    margin: 0;
}

.nav-tabs > li > a {
    color: white;
    border: none;
    padding: 15px 20px;
    margin: 0;
    border-radius: 0;
    font-weight: 600;
    transition: all 0.3s ease;
}

.nav-tabs > li.active > a,
.nav-tabs > li.active > a:hover,
.nav-tabs > li.active > a:focus {
    background: white;
    color: #667eea;
    border: none;
    box-shadow: inset 0 -3px 0 #667eea;
}

.nav-tabs > li > a:hover {
    background: rgba(255,255,255,0.1);
    border: none;
}

.tab-content {
    padding: 30px;
    background: white;
    min-height: 400px;
}

/* Amélioration des graphiques */
.chart-container {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Amélioration des ibox */
.ibox {
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-bottom: 20px;
}

.ibox-title {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 15px 20px;
}

.ibox-content {
    padding: 20px;
}

/* Amélioration des tableaux */
.table-bordered {
    border-radius: 8px;
    overflow: hidden;
}

.table th {
    background: #f8f9fa;
    color: #495057;
    font-weight: 600;
}

.table-striped > tbody > tr:nth-of-type(odd) {
    background-color: #f8f9fa;
}

/* Labels colorés */
.label {
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 600;
}

/* Animation pour les statistiques */
.statistic-box {
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    transition: transform 0.3s ease;
}

.statistic-box:hover {
    transform: scale(1.05);
}

.statistic-box h4 {
    color: #667eea;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 5px;
}

.statistic-box p {
    color: #6c757d;
    margin: 0;
    font-size: 12px;
}

/* Responsive */
@media (max-width: 768px) {
    .nav-tabs > li > a {
        padding: 10px 15px;
        font-size: 12px;
    }
    
    .tab-content {
        padding: 15px;
    }
    
    .widget {
        margin-bottom: 15px;
    }
}
</style>
{% endblock %}
