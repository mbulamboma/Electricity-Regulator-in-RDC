{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
/* Reset Bootstrap conflicts and Design Inspinia pour nouveau message */
.container-fluid.p-0 {
    padding: 0 !important;
}

/* Design Inspinia pour la composition de message */
.compose-wrapper {
    background: #f3f3f4 !important;
    min-height: calc(100vh - 120px);
    margin: 0 !important;
    padding: 20px !important;
    width: 100% !important;
}

.compose-container {
    background: white !important;
    border-radius: 2px;
    box-shadow: 0 1px 1px rgba(0,0,0,0.15) !important;
    overflow: hidden;
    font-family: 'Open Sans', 'Helvetica Neue', Arial, sans-serif !important;
    font-size: 13px !important;
    max-width: 900px;
    margin: 0 auto;
}
.compose-header {
    background: #f9f9f9 !important;
    border-bottom: 1px solid #e7eaec !important;
    padding: 15px 20px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
}

.compose-header h1 {
    font-size: 18px !important;
    font-weight: 400 !important;
    margin: 0 !important;
    color: #676a6c !important;
}

.compose-header p {
    font-size: 12px !important;
    color: #a7a7a7 !important;
    margin: 0 !important;
}

.compose-form {
    padding: 20px !important;
    background: white !important;
}

.form-group {
    margin-bottom: 15px !important;
}

.form-label {
    display: block !important;
    margin-bottom: 5px !important;
    font-size: 12px !important;
    color: #676a6c !important;
    font-weight: 500 !important;
}

.form-control {
    width: 100% !important;
    padding: 8px 12px !important;
    border: 1px solid #e7eaec !important;
    border-radius: 3px !important;
    font-size: 13px !important;
    background: white !important;
}

.form-control:focus {
    outline: none !important;
    border-color: #1ab394 !important;
    box-shadow: none !important;
}

.form-select {
    width: 100% !important;
    padding: 8px 12px !important;
    border: 1px solid #e7eaec !important;
    border-radius: 3px !important;
    font-size: 13px !important;
    background: white !important;
}

.form-select:focus {
    outline: none !important;
    border-color: #1ab394 !important;
    box-shadow: none !important;
}

.priority-selector {
    display: flex !important;
    gap: 10px !important;
    margin-bottom: 15px !important;
}

.priority-option {
    flex: 1 !important;
    position: relative !important;
}

.priority-radio {
    display: none !important;
}

.priority-label {
    display: block !important;
    padding: 8px 12px !important;
    border: 1px solid #e7eaec !important;
    border-radius: 3px !important;
    text-align: center !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    font-weight: 500 !important;
    font-size: 12px !important;
    background: white !important;
    color: #676a6c !important;
}

.priority-label:hover {
    border-color: #1ab394 !important;
    background: #f3f3f4 !important;
}

.priority-radio:checked + .priority-label {
    border-color: #1ab394 !important;
    background: #1ab394 !important;
    color: white !important;
}

.priority-normal .priority-label {
    color: #676a6c !important;
}

.priority-important .priority-label {
    color: #676a6c !important;
}

.priority-urgent .priority-label {
    color: #676a6c !important;
}

.priority-radio:checked + .priority-normal {
    border-color: #1ab394 !important;
    background: #1ab394 !important;
    color: white !important;
}

.priority-radio:checked + .priority-important {
    border-color: #f8ac59 !important;
    background: #f8ac59 !important;
    color: white !important;
}

.priority-radio:checked + .priority-urgent {
    border-color: #ed5565 !important;
    background: #ed5565 !important;
    color: white !important;
}

.btn-send {
    background: #1ab394 !important;
    border: 1px solid #1ab394 !important;
    color: white !important;
    padding: 8px 20px !important;
    border-radius: 3px !important;
    font-weight: 500 !important;
    font-size: 12px !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

.btn-send:hover {
    background: #179d7a !important;
    border-color: #179d7a !important;
    color: white !important;
}

.btn-cancel {
    background: white !important;
    border: 1px solid #e7eaec !important;
    color: #676a6c !important;
    padding: 8px 15px !important;
    border-radius: 3px !important;
    font-weight: 500 !important;
    font-size: 12px !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    text-decoration: none !important;
}

.btn-cancel:hover {
    background: #f3f3f4 !important;
    border-color: #d1d1d1 !important;
    color: #676a6c !important;
    text-decoration: none !important;
}

.form-actions {
    background: #f9f9f9 !important;
    border-top: 1px solid #e7eaec !important;
    padding: 15px 20px !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
    margin: 0 -20px -20px -20px !important;
}

.character-count {
    font-size: 11px !important;
    color: #a7a7a7 !important;
    margin-left: auto !important;
}

.textarea-container {
    position: relative !important;
    margin-bottom: 15px !important;
}

.form-control.textarea {
    width: 100% !important;
    height: 200px !important;
    padding: 12px !important;
    border: 1px solid #e7eaec !important;
    border-radius: 3px !important;
    font-size: 13px !important;
    font-family: inherit !important;
    resize: vertical !important;
    background: white !important;
}

.form-control.textarea:focus {
    outline: none !important;
    border-color: #1ab394 !important;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
    .compose-container {
        margin: 0 10px !important;
    }
    
    .priority-selector {
        flex-direction: column !important;
    }
    
    .form-actions {
        flex-direction: column !important;
        gap: 10px !important;
        text-align: center !important;
    }
}


    

</style>
{% endblock %}

{% block content %}
<div class="compose-wrapper">
    <div class="compose-container">
        <!-- En-tête Inspinia -->
        <div class="compose-header">
            <div>
                <h1><i class="fas fa-paper-plane"></i> {{ title }}</h1>
                <p>Communiquez efficacement avec les autres utilisateurs du système</p>
            </div>
            <div>
                <a href="{{ url_for('notifications.messages') }}" class="btn-cancel">
                    <i class="fas fa-arrow-left"></i> Retour aux messages
                </a>
            </div>
        </div>

        <!-- Formulaire Inspinia -->
        <div class="compose-form">
                    <form method="POST" id="composeForm">
                        {{ form.hidden_tag() }}
                        
                        <!-- Destinataire -->
                        <div class="form-group">
                            <label for="destinataire" class="form-label">
                                <i class="fas fa-user"></i> Destinataire
                            </label>
                            {{ form.destinataire_id(class="form-select", id="destinataire") }}
                            {% if form.destinataire_id.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.destinataire_id.errors %}
                                        <i class="fas fa-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Sujet -->
                        <div class="form-group">
                            <label for="sujet" class="form-label">
                                <i class="fas fa-tag"></i> Sujet du message
                            </label>
                            {{ form.sujet(class="form-control", id="sujet", placeholder="Saisissez le sujet du message...") }}
                            {% if form.sujet.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.sujet.errors %}
                                        <i class="fas fa-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Priorité -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-flag"></i> Niveau de priorité
                            </label>
                            <div class="priority-selector">
                                <div class="priority-option priority-normal">
                                    <input type="radio" name="priorite" value="1" id="priority_normal" class="priority-radio" {{ 'checked' if not form.priorite.data or form.priorite.data == 1 }}>
                                    <label for="priority_normal" class="priority-label">
                                        <i class="fas fa-circle"></i> Normal
                                    </label>
                                </div>
                                <div class="priority-option priority-important">
                                    <input type="radio" name="priorite" value="2" id="priority_important" class="priority-radio" {{ 'checked' if form.priorite.data == 2 }}>
                                    <label for="priority_important" class="priority-label">
                                        <i class="fas fa-exclamation"></i> Important
                                    </label>
                                </div>
                                <div class="priority-option priority-urgent">
                                    <input type="radio" name="priorite" value="3" id="priority_urgent" class="priority-radio" {{ 'checked' if form.priorite.data == 3 }}>
                                    <label for="priority_urgent" class="priority-label">
                                        <i class="fas fa-exclamation-triangle"></i> Urgent
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            {{ form.priorite.label(class="form-label") }}
                            {{ form.priorite(class="form-select") }}
                            {% if form.priorite.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.priorite.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Message -->
                        <div class="form-group">
                            <label for="contenu" class="form-label">
                                <i class="fas fa-comment"></i> Message
                            </label>
                            <div class="textarea-container">
                                {{ form.contenu(class="form-control textarea", rows="10", placeholder="Tapez votre message ici...", maxlength="2000", id="contenu") }}
                                {% if form.contenu.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.contenu.errors %}
                                            <i class="fas fa-exclamation-circle"></i> {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" form="composeForm" class="btn-send">
                        <i class="fas fa-paper-plane"></i> Envoyer le message
                    </button>
                    
                    <a href="{{ url_for('notifications.messages') }}" class="btn-cancel">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                    
                    <div class="character-count">
                        <span id="charCount">0</span>/2000 caractères
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Compteur de caractères simple
    const textarea = document.getElementById('contenu');
    const charCounter = document.getElementById('charCount');
    
    if (textarea && charCounter) {
        function updateCharCounter() {
            const currentLength = textarea.value.length;
            charCounter.textContent = currentLength;
        }
        
        updateCharCounter();
        textarea.addEventListener('input', updateCharCounter);
    }
});
</script>
{% endblock %}